# BGP-ASPA

ASPA对域间路由泄露攻击的防御能力的研究与仿真，由 https://github.com/ssbgp/simulator 修改而来

域间路由关系详见 [here](https://www.cs.princeton.edu/~jrex/papers/sigmetrics00.long.pdf)

## Tips 1

    注意：本模拟器的链路都是单向的！！！

1. 导出提供者路由：AS在与提供者交换路由信息时，可以导出自己的路由和客户的路由，但不能导出从其他提供者或对等体学习到的路由。也就是说，AS 不为其提供者提供中转服务。

2. 导出客户路由：在与客户交换路由信息时，AS 可以导出其路由，以及从其提供者和对等方学习到的路由。也就是说，AS 确实为其客户提供中转服务。

3. 导出对等体路由：AS 在与对等点交换路由信息时，可以导出自己的路由和客户的路由，但不能导出从其他提供商或对等点学习到的路由。即一个AS不为其对等体提供中转服务

   topo文件中，后一个为源AS，前一个为目的AS

- **C** - 客户路由，即从客户AS导出的路由（来自客户AS，从客户指向提供商），根据规则，它能够传递到任意邻居

- **P** - 提供商路由，即从提供商AS导出的路由（来自提供商AS，从提供商指向客户），根据规则，它只能传递给客户

- **R** - 对等体路由，即从对等体AS导出的路由（来自对等体AS，从对等体指向对等体），根据规则，它只能传递给客户

规则：

客户能够将通告发送给客户、提供商、对等体；而提供商、对等体只能把路由通告发送给客户

从**客户链路**学习来的路由发送给所有邻居，从**邻居链路**和**提供者链路**学习来的路由只发送给客户

## Tips 2

`.nodes.csv`文件中，本地优先级 **Local Preference** 指的是要到达设定的目标AS需要经过的路由的优先级

- **◦** - 代表目的AS本身

- **•** - 代表无法到达目的AS

- **C** - 代表消息传到目的AS的本地优先级为客户级别（最高）

- **P** - 代表消息传到目的AS的本地优先级为供应商级别（最低）

- **R** - 代表消息传到目的AS的本地优先级为对等体级别（次高）

## Tips 3

测试用的启动项，这能够输出尽可能多的测试文件

````
-t ./topo/topo.topo -d 2 -c 1 -rn -tr -meta -o ./output
````

## Tips 4

**如何实现BGP泄露与ASPA的部署？**

- **路由泄露** ：应当选定一个或者多个攻击者节点，对于攻击者节点，它在接收路由时，可能可以将来自 peer 和 provider 的本地优先级变为 customer 的（或者反之）

- **ASPA部署** ：应当选定一个或者多个防御者节点，对于防御者节点，它在接收路由时，可以验证AS-Path中的**每一个链路**，确认其中链路是否合法，如不合法（如存在peer to provider），则拒绝这条路由

- **评价参数** ：保护成功的ASPA节点等。注意，应当是安全性的参数而非网络参数

在拓扑文件中，设置新的 **ASPA** 协议类型，攻击者节点协议使用字符串 **ASPA-A** 指代，防御者节点协议使用字符串 **ASPA-D** 指代。

代码方面，需要

- ***目前工作*** 编写 **ASPA** 协议类，其应为 **BGP** 类的子类
- ***目前工作*** 编写IO模块的拓扑文件读取部分，使其能够正确识别ASPA攻击/防御节点
- ***目前工作*** 攻击者节点应当有多种类型：
    - 将 peer/provider 的本地优先级变为 customer
    - 将 customer 的本地优先级变为 peer/provider
    - 包含以上两种情况的攻击者节点
- ***目前工作*** 防御者节点应当实现以下策略：
    - 通过接受的通告中的 AS-Path ，逐个节点验证域间路由链路关系是否合法，若不合法，则将该通告设为非法，并不再传递
- ***下一步工作*** 拓扑设计：
    - 考虑攻击者/防御者数量的增加/减少对整体链路的防御性能
    - 根据拓扑结构，分析出主要节点，使得该节点作为防御者时能够发挥最大的性能（可以从节点的度、节点层级方面考虑，同时也需要考虑攻击节点的位置）

## Tips 5

思路：为攻击/防御节点在Node类中设置标识，同时通过域间路由的扩展器来确保攻击能力。还需要研究通知功能来使得泄露的节点能够被体现。

Q: 如何实现ASPA路由源泄露检测与预防？

A: 获取整个链路的域间路由关系后，如果有如下情况的将判断为路由泄露（后续在输出时会分辨泄露类型）

1. 连续的p是允许的，即上一层的提供者迭代地一直导出路由给下一层的客户；但是，p接c、r都是不允许的，因为来自提供商的路由不能导出给其他的提供商或对等体
2. r接p是允许的，这代表对等体的路由传递给了客户；任意连续的两个以上的r（在对等体中传递）、r接c（对等体路由传递给提供商）是不允许的
3. c后能够接任意路由关系

总结来说，任意两个连续的（前后顺序十分重要）路由关系中，合法性和非法性区分如下：

| 合法的                     | 非法的                |
|:------------------------|--------------------|
| p-p, r-p, c-c, c-p, c-r | p-r, p-c, r-r, r-c |

那么在防御节点中，对于收到的路由消息可以根据其带域间路由关系的ASPath来判断该消息是否是符合域间路由规则的